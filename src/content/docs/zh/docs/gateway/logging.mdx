---
title: 日志
description: 日志表面、文件日志、WS 日志风格和控制台格式化。
sidebar:
  label: 日志
  order: 12
---

# 日志

有关面向用户的概览 (CLI + 控制 UI + 配置)，请参见 [/zh/docs/logging](/zh/docs/logging)。

OpenClaw 有两个日志“表面”：

- **控制台输出** (你在终端 / 调试 UI 中看到的)。
- **文件日志** (JSON 行) 由 Gateway 记录器写入。

## 基于文件的记录器

- 默认滚动日志文件位于 `/tmp/openclaw/` 下 (每天一个文件)：`openclaw-YYYY-MM-DD.log`
  - 日期使用 Gateway 主机的本地时区。
- 日志文件路径和级别可以通过 `~/.openclaw/openclaw.json` 配置：
  - `logging.file`
  - `logging.level`

文件格式为每行一个 JSON 对象。

控制 UI 的 Logs 选项卡通过 Gateway (`logs.tail`) 跟踪此文件。
CLI 也可以做同样的事情：

```bash
openclaw logs --follow
```

**Verbose vs. 日志级别**

- **文件日志** 仅由 `logging.level` 控制。
- `--verbose` 仅影响 **控制台详细程度** (和 WS 日志风格)；它 **不** 提高文件日志级别。
- 要在文件日志中捕获仅限 verbose 的详细信息，请将 `logging.level` 设置为 `debug` 或 `trace`。

## 控制台捕获

CLI 捕获 `console.log/info/warn/error/debug/trace` 并将它们写入文件日志，同时仍然打印到 stdout/stderr。

你可以通过以下方式独立调整控制台详细程度：

- `logging.consoleLevel` (默认 `info`)
- `logging.consoleStyle` (`pretty` | `compact` | `json`)

## 工具摘要脱敏

详细的工具摘要 (例如 `🛠️ Exec: ...`) 可以在进入控制台流之前屏蔽敏感令牌。这是 **仅限工具** 的，不会改变文件日志。

- `logging.redactSensitive`: `off` | `tools` (默认：`tools`)
- `logging.redactPatterns`: 正则表达式字符串数组 (覆盖默认值)
  - 使用原始正则表达式字符串 (自动 `gi`)，如果你需要自定义标志，则使用 `/pattern/flags`。
  - 匹配项通过保留前 6 个 + 后 4 个字符 (长度 >= 18) 进行屏蔽，否则为 `***`。
  - 默认值涵盖常见的密钥分配、CLI 标志、JSON 字段、bearer 标头、PEM 块和流行的令牌前缀。

## Gateway WebSocket 日志

Gateway 以两种模式打印 WebSocket 协议日志：

- **正常模式 (无 `--verbose`)**：仅打印“有趣”的 RPC 结果：
  - 错误 (`ok=false`)
  - 慢速调用 (默认阈值：`>= 50ms`)
  - 解析错误
- **详细模式 (`--verbose`)**：打印所有 WS 请求/响应流量。

### WS 日志风格

`openclaw gateway` 支持每个 Gateway 的风格切换：

- `--ws-log auto` (默认)：正常模式经过优化；详细模式使用紧凑输出
- `--ws-log compact`: 详细模式时使用紧凑输出 (配对的请求/响应)
- `--ws-log full`: 详细模式时使用完整的每帧输出
- `--compact`: `--ws-log compact` 的别名

示例：

```bash
# 优化 (仅错误/慢速)
openclaw gateway

# 显示所有 WS 流量 (配对)
openclaw gateway --verbose --ws-log compact

# 显示所有 WS 流量 (完整元数据)
openclaw gateway --verbose --ws-log full
```

## 控制台格式化 (子系统日志)

控制台格式化程序是 **TTY 感知** 的，并打印一致的、带前缀的行。
子系统记录器保持输出分组和可扫描。
