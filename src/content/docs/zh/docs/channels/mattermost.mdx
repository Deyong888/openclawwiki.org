---
title: Mattermost
description: Mattermost 机器人设置和 OpenClaw 配置
sidebar:
  label: Mattermost
  order: 27
---

# Mattermost (插件)

状态：通过插件支持（机器人令牌 + WebSocket 事件）。支持频道、群组和私信。
Mattermost 是一个可自托管的团队消息平台；产品详情和下载请参阅官方网站 [mattermost.com](https://mattermost.com)。

## 需要插件
Mattermost 作为插件发布，不随核心安装包捆绑。

通过 CLI 安装 (npm 注册表):
```bash
openclaw plugins install @openclaw/mattermost
```

本地检出（从 git 仓库运行时）：
```bash
openclaw plugins install ./extensions/mattermost
```

如果在配置/引导期间选择 Mattermost 并且检测到 git 检出，OpenClaw 将自动提供本地安装路径。

详情：[插件 (Plugins)](/docs/plugin)

## 快速设置
1) 安装 Mattermost 插件。
2) 创建一个 Mattermost 机器人账户并复制 **bot token**。
3) 复制 Mattermost **base URL** (例如 `https://chat.example.com`)。
4) 配置 OpenClaw 并启动网关。

最小配置：
```json5
{
  channels: {
    mattermost: {
      enabled: true,
      botToken: "mm-token",
      baseUrl: "https://chat.example.com",
      dmPolicy: "pairing"
    }
  }
}
```

## 环境变量 (默认账户)
如果你更喜欢环境变量，请在网关主机上设置这些：

- `MATTERMOST_BOT_TOKEN=...`
- `MATTERMOST_URL=https://chat.example.com`

环境变量仅适用于 **默认** 账户 (`default`)。其他账户必须使用配置值。

## 聊天模式 (Chat modes)
Mattermost 会自动回复私信。频道行为由 `chatmode` 控制：

- `oncall` (默认): 仅在频道中被 @提及 时回复。
- `onmessage`: 回复每条频道消息。
- `onchar`: 当消息以触发前缀开头时回复。

配置示例：
```json5
{
  channels: {
    mattermost: {
      chatmode: "onchar",
      oncharPrefixes: [">", "!"]
    }
  }
}
```

注意：
- `onchar` 仍然响应显式的 @提及。
- `channels.mattermost.requireMention` 在旧版配置中有效，但首选 `chatmode`。

## 访问控制 (私信)
- 默认: `channels.mattermost.dmPolicy = "pairing"` (未知发送者会收到配对码)。
- 批准方式：
  - `openclaw pairing list mattermost`
  - `openclaw pairing approve mattermost <CODE>`
- 公共私信: `channels.mattermost.dmPolicy="open"` 加上 `channels.mattermost.allowFrom=["*"]`.

## 频道 (群组)
- 默认: `channels.mattermost.groupPolicy = "allowlist"` (提及门控)。
- 使用 `channels.mattermost.groupAllowFrom` 将发送者加入白名单（用户 ID 或 `@username`）。
- 开放频道: `channels.mattermost.groupPolicy="open"` (提及门控)。

## 出站投递目标
使用这些目标格式与 `openclaw message send` 或 cron/webhooks 一起使用：

- `channel:<id>` 用于频道
- `user:<id>` 用于私信
- `@username` 用于私信（通过 Mattermost API 解析）

裸 ID 被视为频道。

## 多账户
Mattermost 支持在 `channels.mattermost.accounts` 下配置多个账户：

```json5
{
  channels: {
    mattermost: {
      accounts: {
        default: { name: "Primary", botToken: "mm-token", baseUrl: "https://chat.example.com" },
        alerts: { name: "Alerts", botToken: "mm-token-2", baseUrl: "https://alerts.example.com" }
      }
    }
  }
}
```

## 故障排除
- 频道中无回复：确保机器人在频道中并提及它 (oncall)，使用触发前缀 (onchar)，或设置 `chatmode: "onmessage"`。
- 身份验证错误：检查机器人令牌、基础 URL 以及账户是否已启用。
- 多账户问题：环境变量仅适用于 `default` 账户。
